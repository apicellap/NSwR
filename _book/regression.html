<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Regression | A Guide to The New Statistics with R</title>
<meta name="author" content="Pete Apicella">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 7 Regression | A Guide to The New Statistics with R">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 Regression | A Guide to The New Statistics with R">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
<meta name="description" content='7.1 Introduction install.packages("arm", repos = "https://cran.us.r-project.org") install.packages("ggplot2", repos = "https://cran.us.r-project.org") install.packages("MASS", repos =...'>
<meta property="og:description" content='7.1 Introduction install.packages("arm", repos = "https://cran.us.r-project.org") install.packages("ggplot2", repos = "https://cran.us.r-project.org") install.packages("MASS", repos =...'>
<meta name="twitter:description" content='7.1 Introduction install.packages("arm", repos = "https://cran.us.r-project.org") install.packages("ggplot2", repos = "https://cran.us.r-project.org") install.packages("MASS", repos =...'>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Guide to The New Statistics with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="motivation.html"><span class="header-section-number">2</span> Motivation</a></li>
<li><a class="" href="description.html"><span class="header-section-number">3</span> Description</a></li>
<li><a class="" href="reproducible-research.html"><span class="header-section-number">4</span> Reproducible Research</a></li>
<li><a class="" href="estimation.html"><span class="header-section-number">5</span> Estimation</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">6</span> Linear models</a></li>
<li><a class="active" href="regression.html"><span class="header-section-number">7</span> Regression</a></li>
<li><a class="" href="prediction.html"><span class="header-section-number">8</span> Prediction</a></li>
<li><a class="" href="testing.html"><span class="header-section-number">9</span> Testing</a></li>
<li><a class="" href="intervals.html"><span class="header-section-number">10</span> Intervals</a></li>
<li><a class="" href="analysis-of-variance.html"><span class="header-section-number">11</span> Analysis of Variance</a></li>
<li><a class="" href="factorial-designs.html"><span class="header-section-number">12</span> Factorial designs</a></li>
<li><a class="" href="analysis-of-covariance.html"><span class="header-section-number">13</span> Analysis of Covariance</a></li>
<li><a class="" href="linear-model-complexities.html"><span class="header-section-number">14</span> Linear Model Complexities</a></li>
<li><a class="" href="generalized-linear-models-glms.html"><span class="header-section-number">15</span> Generalized Linear Models (GLMs)</a></li>
<li><a class="" href="glms-for-count-data.html"><span class="header-section-number">16</span> GLMs for Count Data</a></li>
<li><a class="" href="binomial-glms.html"><span class="header-section-number">17</span> Binomial GLMs</a></li>
<li><a class="" href="glms-for-binary-data.html"><span class="header-section-number">18</span> GLMs for binary data</a></li>
<li><a class="" href="conclusions.html"><span class="header-section-number">19</span> Conclusions</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/apicellap/NSwR.git">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="regression" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Regression<a class="anchor" aria-label="anchor" href="#regression"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-4" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-4"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"arm"</span>,  repos <span class="op">=</span> <span class="st">"https://cran.us.r-project.org"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span>,  repos <span class="op">=</span> <span class="st">"https://cran.us.r-project.org"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"MASS"</span>,  repos <span class="op">=</span> <span class="st">"https://cran.us.r-project.org"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"SemiPar"</span>,  repos <span class="op">=</span> <span class="st">"https://cran.us.r-project.org"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"agricolae"</span>,  repos <span class="op">=</span> <span class="st">"https://cran.us.r-project.org"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"ggfortify"</span>,  repos <span class="op">=</span> <span class="st">"https://cran.us.r-project.org"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://CRAN.R-project.org/package=arm">arm</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://matt-wand.utsacademics.info/SPmanu.pdf">SemiPar</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">agricolae</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sinhrks/ggfortify">ggfortify</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="linear-regression" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Linear regression<a class="anchor" aria-label="anchor" href="#linear-regression"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Linear regression
<ul>
<li>Used to define a relationship between a response and explanatory variable</li>
<li>A scatter plot is used to draw a straight line through it to model the mean</li>
<li>Variability around the mean is captured by the size of the standard errors
<ul>
<li>and is reflected by the confidence intervals calculated from them</li>
</ul>
</li>
<li>We use <span class="math inline">\(y = b + mx\)</span>
<ul>
<li>
<span class="math inline">\(y\)</span> = the predicted value of the response variable (i.e. hardness in janka data)</li>
<li>
<span class="math inline">\(b\)</span> = the regression intercept (<span class="math inline">\(y\)</span> when <span class="math inline">\(x = 0\)</span>)</li>
<li>
<span class="math inline">\(m\)</span> = the slope of the regression line</li>
<li>
<span class="math inline">\(x\)</span> = the value of the explanatory variable (i.e. density in janka data)</li>
</ul>
</li>
<li>Unexplained residual (error) variation can be added as an additional term, <span class="math inline">\(e\)</span>
<ul>
<li><span class="math inline">\(y = b + mx + e\)</span></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div id="janka-timber-hardness-data" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Janka timber hardness data<a class="anchor" aria-label="anchor" href="#janka-timber-hardness-data"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>The goal of collecting this data was to establish a linear relationship between wood density and hardness</li>
<li>Density is easier to measure than hardness so this is testing if density can be used as a proxy</li>
<li>This dataset includes 36 samples of wood from unique tree species</li>
<li>Once a linear relationship is established, the model can be used to predict timber hardness of wood with a known density value</li>
<li>Data are found in the SemiPar package and in the dataframe, janka</li>
</ul>
<p>Need to load the data from the semipar package:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">janka</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">janka</span><span class="op">)</span>
<span class="co">#&gt;   dens hardness</span>
<span class="co">#&gt; 1 24.7      484</span>
<span class="co">#&gt; 2 24.8      427</span>
<span class="co">#&gt; 3 27.3      413</span>
<span class="co">#&gt; 4 28.4      517</span>
<span class="co">#&gt; 5 28.4      549</span>
<span class="co">#&gt; 6 29.0      648</span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">janka</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    36 obs. of  2 variables:</span>
<span class="co">#&gt;  $ dens    : num  24.7 24.8 27.3 28.4 28.4 29 30.3 32.7 35.6 38.5 ...</span>
<span class="co">#&gt;  $ hardness: int  484 427 413 517 549 648 587 704 979 914 ...</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xlabel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Wood density (lbs • "</span>, <span class="va">ft</span><span class="op">^</span><span class="op">-</span><span class="fl">3</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="co">#expression allows you to modify certain parts of the text of the label</span>
<span class="va">ylabel</span> <span class="op">&lt;-</span> <span class="st">"Timber hardness (lbf)"</span></code></pre></div>
<p>Visualize the data - Wood hardness as a function of density - via a scatterplot:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fig7_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">janka</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dens</span>, y <span class="op">=</span> <span class="va">hardness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="va">xlabel</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="va">ylabel</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">fig7_1</span></code></pre></div>
<div class="inline-figure"><img src="07_regression_files/figure-html/janka-viz-07-1.png" width="672"></div>
<p>There is a positive relationship and the relationship between wood hardness and density seems to be linear</p>
</div>
<div id="correlation" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Correlation<a class="anchor" aria-label="anchor" href="#correlation"><i class="fas fa-link"></i></a>
</h2>
<p>Test the strength of the correlation:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">janka</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">dens</span>, <span class="va">hardness</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.9743345</span></code></pre></div>
<ul>
<li>This value is very close to +1; therefore, there is a strong positive linear relationship between the two variables</li>
<li>We can go beyond correlation and argue that higher wood density causes higher timber hardness by using linear regression
<ul>
<li>Mathematically, that would be to say changes in <span class="math inline">\(x\)</span> lead to changes in <span class="math inline">\(y\)</span>
</li>
</ul>
</li>
</ul>
</div>
<div id="linear-regression-in-r" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Linear regression in R<a class="anchor" aria-label="anchor" href="#linear-regression-in-r"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>The data are similiar to the Darwin data except that the explanatory variable, density, is continuous</li>
</ul>
<p>Create a linear model:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">janka.ls1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">hardness</span> <span class="op">~</span> <span class="va">dens</span>, data <span class="op">=</span> <span class="va">janka</span><span class="op">)</span></code></pre></div>
<ul>
<li>The model estimates a ‘line of best fit’ (the regression line) by using the method of least squares to minimize the error sums of squares, which is the average distance between datapoints and the line (see appendix 7b)</li>
</ul>
<p>Add the linear model regression line (and a 95% CI band) to the the scatter plot:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fig7_2</span> <span class="op">&lt;-</span> <span class="va">fig7_1</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span>  <span class="co">#fit a linear model regression line to the data points </span>
<span class="va">fig7_2</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<div class="inline-figure"><img src="07_regression_files/figure-html/janka-mod-viz-07-1.png" width="672"></div>
<ul>
<li>Figure takeaways:
<ul>
<li>The CI has curved upper and lower bounds that are narrowest in the middle</li>
<li>This results from it being calculated from standard errors for the regression intercept and regression slope</li>
<li>There is uncertainty about the elevation of the line and its gradient</li>
</ul>
</li>
</ul>
<p>Check the model’s estimates of the coefficients:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/arm/man/display.html">display</a></span><span class="op">(</span><span class="va">janka.ls1</span><span class="op">)</span>
<span class="co">#&gt; lm(formula = hardness ~ dens, data = janka)</span>
<span class="co">#&gt;             coef.est coef.se </span>
<span class="co">#&gt; (Intercept) -1160.50   108.58</span>
<span class="co">#&gt; dens           57.51     2.28</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; n = 36, k = 2</span>
<span class="co">#&gt; residual sd = 183.06, R-Squared = 0.95</span></code></pre></div>
<ul>
<li>display(janka.ls1) takeaways:</li>
<li>
<strong>Intercept</strong> refers to the hardness variable
<ul>
<li>The <strong>Intercept</strong>’s <strong>coef.est</strong> (<span class="math inline">\(y = -1160.50\)</span> is for when <span class="math inline">\(x (density) = 0\)</span>
<ul>
<li>Side note: it’s not possible to have a negative hardness or a density of zero, so this is somewhat of an artifact of the analysis</li>
</ul>
</li>
<li>
<strong>coef.se</strong> is the standard errorr of the regression intercept
<ul>
<li>One thing to do to get more meaning out of this data is a technique called centering</li>
</ul>
</li>
<li>Centering means subtracting the average density value (x) from each individual value</li>
<li>This is a useful strategy because they provide the value of the response for the average value of the explanatory variable</li>
</ul>
</li>
<li>
<strong>dens</strong> = 57.51 is the value of the regression slope
<ul>
<li>increase of 1 unit wood density means an increase in timber hardness by 57.51 units</li>
</ul>
</li>
<li>
<strong>n</strong> = sample size</li>
<li>
<strong>k</strong> = number of estimated parameters (regression intercept and slope)</li>
<li>
<strong>R-squared</strong> = proportion of the variation in the data explained by the linear regression analysis</li>
</ul>
<p>Find CI (95%) upper and lower bounds:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">janka.ls1</span><span class="op">)</span>
<span class="co">#&gt;                   2.5 %     97.5 %</span>
<span class="co">#&gt; (Intercept) -1381.16001 -939.83940</span>
<span class="co">#&gt; dens           52.87614   62.13721</span></code></pre></div>
</div>
<div id="assumptions" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>The linear model here makes all the same assumptions about the data as we have seen before including:
<ul>
<li>The assumption that the unexplained variability around the regression line (the residuals) is approximately normal and has constant variance</li>
<li>The residuals are the differences observed between the observed datapoints and the fitted values predicted by the model
<ul>
<li>Residual differences are the vertical distances between the datapoints and the corresponding points on the regression line (fitted values)</li>
<li>Residuals are represented in the red lines on the Figure 7.3</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Display (two of the) residuals graphically on the fitted regression data:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fig7_3</span> <span class="op">&lt;-</span> 
  <span class="va">fig7_1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, 
                       se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">66</span>, xend <span class="op">=</span> <span class="fl">66</span>, y <span class="op">=</span><span class="fl">3250</span>, yend <span class="op">=</span> <span class="fl">2650</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">59.8</span>, xend <span class="op">=</span> <span class="fl">59.8</span>, y <span class="op">=</span><span class="fl">1955</span>, yend <span class="op">=</span> <span class="fl">2265</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> 
<span class="va">fig7_3</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<div class="inline-figure"><img src="07_regression_files/figure-html/residuals-plot-07-1.png" width="672"></div>
<ul>
<li>Figure 7.3 takeaways:
<ul>
<li>In this graph, we see two of those residuals, which are vertical differences
<ul>
<li>Each datapoint has a corresponding fitted value at each x value</li>
</ul>
</li>
<li>The linear model analysis finds the regression ‘line of best fit’ by using the method of least squares to minimize the average distance between the datapoints and the line (the unexplained variation
<ul>
<li>If we imagine a red line from each datapoint to the blue line
<ul>
<li>These vertical distances are used for the best fit calculation</li>
</ul>
</li>
<li>This method will be discussed further in chapter 11</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Extract the fitted values predicted by the linear model:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">janka.ls1</span><span class="op">)</span>
<span class="co">#&gt;         1         2         3         4         5         6 </span>
<span class="co">#&gt;  259.9152  265.6658  409.4325  472.6899  472.6899  507.1939 </span>
<span class="co">#&gt;         7         8         9        10        11        12 </span>
<span class="co">#&gt;  581.9525  719.9686  886.7379 1053.5073 1070.7593 1099.5126 </span>
<span class="co">#&gt;        13        14        15        16        17        18 </span>
<span class="co">#&gt; 1105.2633 1134.0166 1157.0193 1174.2713 1180.0220 1180.0220 </span>
<span class="co">#&gt;        19        20        21        22        23        24 </span>
<span class="co">#&gt; 1306.5366 1473.3060 1536.5633 1611.3220 1801.0940 1801.0940 </span>
<span class="co">#&gt;        25        26        27        28        29        30 </span>
<span class="co">#&gt; 1910.3567 2059.8741 2088.6274 2134.6328 2151.8848 2243.8954 </span>
<span class="co">#&gt;        31        32        33        34        35        36 </span>
<span class="co">#&gt; 2278.3994 2634.9408 2715.4502 2795.9595 2813.2115 2813.2115</span></code></pre></div>
<p>Extract the residuals:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">janka.ls1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;          1          2          3          4          5 </span>
<span class="co">#&gt; 224.084837 161.334170   3.567483  44.310140  76.310140 </span>
<span class="co">#&gt;          6 </span>
<span class="co">#&gt; 140.806135</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">janka.ls1</span><span class="op">)</span><span class="op">)</span> <span class="co">#displays the last 6 rows in the dataframe </span>
<span class="co">#&gt;         31         32         33         34         35 </span>
<span class="co">#&gt; -338.39945  625.05917  -15.45018   94.04048  -73.21152 </span>
<span class="co">#&gt;         36 </span>
<span class="co">#&gt;  326.78848</span></code></pre></div>
<p>Check normality of the data:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fig7_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">janka.ls1</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, ncol <span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">fig7_4</span></code></pre></div>
<div class="inline-figure"><img src="07_regression_files/figure-html/janka-norm-07-1.png" width="672"></div>
<ul>
<li>figure shows that the data are fairly normally distributed</li>
<li>outliers are individually labelled on the plot
<ul>
<li>These values have a much bigger value than what is normal for this dataset</li>
</ul>
</li>
</ul>
<p>Check the variability of the data:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fig7_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">janka.ls1</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, ncol <span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">fig7_5</span></code></pre></div>
<div class="inline-figure"><img src="07_regression_files/figure-html/janka-variability-07-1.png" width="672"></div>
<ul>
<li>Figure 7.5 takeaways:
<ul>
<li>Left - raw residuals as a function of the fitted values</li>
<li>Right -
<ul>
<li>Displays the absolute value of the residuals (|residuals|)</li>
<li>Standardizes them by:
<center>
<span class="math inline">\(\sqrt\frac{residual}{residualSD}\)</span>
</center>
</li>
</ul>
</li>
<li>Both plots suggest that the residuals don’t have constant variance
<ul>
<li>Their variability seems to increase as the mean increases</li>
<li>In later chapters, we will see if there is a more appropriate model for this data</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="linear-models.html"><span class="header-section-number">6</span> Linear models</a></div>
<div class="next"><a href="prediction.html"><span class="header-section-number">8</span> Prediction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#regression"><span class="header-section-number">7</span> Regression</a></li>
<li><a class="nav-link" href="#introduction-4"><span class="header-section-number">7.1</span> Introduction</a></li>
<li><a class="nav-link" href="#linear-regression"><span class="header-section-number">7.2</span> Linear regression</a></li>
<li><a class="nav-link" href="#janka-timber-hardness-data"><span class="header-section-number">7.3</span> Janka timber hardness data</a></li>
<li><a class="nav-link" href="#correlation"><span class="header-section-number">7.4</span> Correlation</a></li>
<li><a class="nav-link" href="#linear-regression-in-r"><span class="header-section-number">7.5</span> Linear regression in R</a></li>
<li><a class="nav-link" href="#assumptions"><span class="header-section-number">7.6</span> Assumptions</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/apicellap/NSwR.git/blob/master/07_regression.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/apicellap/NSwR.git/edit/master/07_regression.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Guide to The New Statistics with R</strong>" was written by Pete Apicella. It was last built on 2022-07-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
